<div class="photo-capture-container">
  <div class="camera-selection" *ngIf="availableCameras.length > 0">
    <label for="camera-select">
      <span class="camera-icon">ğŸ“¹</span> Select Camera
      <button type="button" class="refresh-btn" (click)="refreshCameras()" title="Refresh camera list">ğŸ”„</button>
    </label>
    <select id="camera-select" [(ngModel)]="selectedCameraId" (change)="onCameraChange($event)">
      <option *ngFor="let camera of availableCameras" [value]="camera.deviceId">
        {{ getCameraTypeIcon(camera.label) }} {{ camera.label || 'Camera ' + (availableCameras.indexOf(camera) + 1) }}
      </option>
    </select>
    <div class="camera-info" *ngIf="selectedCameraId">
      <span class="info-badge">{{ getCameraType(getSelectedCameraLabel()) }}</span>
    </div>
  </div>

  <!-- Image Quality Settings -->
  <div class="quality-settings">
    <label for="quality-select">
      <span class="setting-icon">âš™ï¸</span> Image Quality (affects file size)
    </label>
    <select id="quality-select" [(ngModel)]="imageQuality" (change)="onQualityChange()">
      <option [value]="0.5">Low (50%) - Smallest file</option>
      <option [value]="0.7">Medium (70%) - Balanced</option>
      <option [value]="0.85">High (85%) - Better quality</option>
      <option [value]="0.95">Very High (95%) - Best quality</option>
    </select>
    <p class="quality-info">ğŸ“· Using camera's native resolution</p>
  </div>

  <div class="video-container" *ngIf="!capturedPhoto">
    <video #video [width]="videoWidth" [height]="videoHeight" autoplay></video>
    <button type="button" class="capture-btn" (click)="capturePhoto()">ğŸ“¸ Capture Photo</button>
  </div>

  <div class="preview-container" *ngIf="capturedPhoto && !showCropper">
    <img [src]="capturedPhoto" alt="Captured Photo" [width]="displayWidth">
    <div class="photo-info">
      <span class="info-text">Size: {{ photoSizeInfo }}</span>
      <span class="info-text">Quality: {{ (imageQuality * 100).toFixed(0) }}%</span>
    </div>
    <div class="action-buttons">
      <button type="button" class="crop-btn" (click)="openCropper()">âœ‚ï¸ Crop Photo</button>
      <button type="button" class="retake-btn" (click)="retakePhoto()">ğŸ”„ Retake Photo</button>
      <button type="button" class="save-btn" (click)="savePhoto()">ğŸ’¾ Save Photo</button>
    </div>
  </div>

  <!-- Image Cropper -->
  <div class="cropper-container" *ngIf="showCropper && capturedPhoto">
    <div class="cropper-header">
      <h3>Crop Photo - {{ getPhotoSizeName() }}</h3>
      <p class="crop-info">Drag to select the area to crop</p>
    </div>
    <div class="crop-area">
      <canvas #cropCanvas 
              (mousedown)="startCrop($event)" 
              (mousemove)="updateCrop($event)" 
              (mouseup)="endCrop()"
              (touchstart)="startCrop($event)"
              (touchmove)="updateCrop($event)"
              (touchend)="endCrop()">
      </canvas>
    </div>
    <div class="crop-actions">
      <button type="button" class="apply-crop-btn" (click)="applyCrop()">âœ“ Apply Crop</button>
      <button type="button" class="cancel-crop-btn" (click)="cancelCrop()">âœ• Cancel</button>
    </div>
  </div>

  <canvas #canvas [width]="canvasWidth" [height]="canvasHeight" style="display:none;"></canvas>
</div>
